<html>
<head>
  <title>事件分发机制</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/276742; Windows/10.0.10240 (Win64);"/>
  <meta name="content-class" content="maxiang"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="415"/>
<h1>事件分发机制</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2015/9/22 20:03</i></td></tr>
</table>
</div>
<br/>

<div><span lang="v2" style="color: #2c3f51; font-family: 'Helvetica Neue', Arial, 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Song, sans-serif; line-height: 1.6;"><del style="position:relative;display:block"><a href="http://maxiang.info/#/?provider=evernote&amp;guid=6225f0aa-29a5-456e-92f9-f25d40878619&amp;notebook=Android%E7%AC%94%E8%AE%B0" style="position: absolute;color: #FFF;text-decoration: none;font-size: 12px;height: 25px;border-radius: 0;margin-top: -20px;right: 15px;background: rgba(0, 0, 0, 0);border-left: 10px solid #BB3A34;border-right: 10px solid #BB3A34;border-bottom: 5px solid rgba(0, 0, 0, 0);width: 0;text-indent:-100000px;">Edit</a></del><div style="color: #2c3f51; font-family: 'Helvetica Neue', Arial, 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Song, sans-serif; line-height: 1.6;">
                        <div style="line-height: 1.6;"></div>
                    <div style="line-height: 1.6;">

<p style="margin: 0 0 1.1em; line-height: 1.6;"></p>

</div><div style="line-height: 1.6;">

<h1 style="font-size: 2.6em; margin: 1.2em 0 .6em 0; font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; text-align: start;">事件分发机制</h1>

<p style="margin: 0 0 1.1em; line-height: 1.6;"><strong style="font-weight: bold; line-height: 1.6;">事件分发public boolean dispatchTouchEvent(MotionEvent ev)</strong></p>

<p style="margin: 0 0 1.1em; line-height: 1.6;">Touch 事件发生时 Activity 的 dispatchTouchEvent(MotionEvent ev) 方法会以隧道方式（从根元素依次往下传递直到最内层子元素或在中间某一元素中由于某一条件停止传递）将事件传递给最外层 View 的 dispatchTouchEvent(MotionEvent ev) 方法，并由该 View 的 dispatchTouchEvent(MotionEvent ev) 方法对事件进行分发。dispatchTouchEvent 的事件分发逻辑如下：</p>

<pre style="word-break: break-word; font-family: 'Source Code Pro',monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 2px; border: 0; border-radius: 5px; text-align: start;"><code style="font-family: 'Source Code Pro',monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 18px 28px;">1. 如果 <span style="line-height: 1.6; color: #f92672;">return</span> true，事件会分发给当前 <span style="line-height: 1.6; color: #f92672;">View</span> 并由 dispatchTouchEvent 方法进行消费，同时事件会停止向下传递；<br/>如果 <span style="line-height: 1.6; color: #f92672;">return</span> false，事件分发分为两种情况：<br/><br/>2. 如果当前 <span style="line-height: 1.6; color: #f92672;">View</span> 获取的事件直接来自 Activity，则会将事件返回给 Activity 的 onTouchEvent 进行消费；<br/>如果当前 <span style="line-height: 1.6; color: #f92672;">View</span> 获取的事件来自外层父控件，则会将事件返回给父 <span style="line-height: 1.6; color: #f92672;">View</span> 的  onTouchEvent 进行消费。<br/><br/>3. 如果返回系统默认的 super.dispatchTouchEvent(ev)，事件会自动的分发给当前 <span style="line-height: 1.6; color: #f92672;">View</span> 的 onInterceptTouchEvent 方法。<br/><br/></code></pre>

<p style="margin: 0 0 1.1em; line-height: 1.6;"><strong style="font-weight: bold; line-height: 1.6;">事件拦截：public boolean onInterceptTouchEvent(MotionEvent ev)</strong></p>

<p style="margin: 0 0 1.1em; line-height: 1.6;">在外层 View 的 dispatchTouchEvent(MotionEvent ev) 方法返回系统默认的 super.dispatchTouchEvent(ev) 情况下，事件会自动的分发给当前 View 的 onInterceptTouchEvent 方法。onInterceptTouchEvent 的事件拦截逻辑如下：</p>

<pre style="word-break: break-word; font-family: 'Source Code Pro',monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 2px; border: 0; border-radius: 5px; text-align: start;"><code style="font-family: 'Source Code Pro',monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 18px 28px;">1. 如果 onInterceptTouchEvent 返回 true，则表示将事件进行拦截，并将拦截到的事件交由当前 <span style="line-height: 1.6; color: #f92672;">View</span> 的 onTouchEvent 进行处理；<br/>2.  如果 onInterceptTouchEvent 返回 false，则表示将事件放行，当前 <span style="line-height: 1.6; color: #f92672;">View</span> 上的事件会被传递到子 <span style="line-height: 1.6; color: #f92672;">View</span> 上，再由子 <span style="line-height: 1.6; color: #f92672;">View</span> 的 dispatchTouchEvent 来开始这个事件的分发；<br/>3. 如果 onInterceptTouchEvent 返回 super.onInterceptTouchEvent(ev)，事件默认会被拦截，并将拦截到的事件交由当前 <span style="line-height: 1.6; color: #f92672;">View</span> 的 onTouchEvent 进行处理。<br/><br/></code></pre>

<p style="margin: 0 0 1.1em; line-height: 1.6;"><strong style="font-weight: bold; line-height: 1.6;">事件响应：public boolean onTouchEvent(MotionEvent ev)</strong></p>

<p style="margin: 0 0 1.1em; line-height: 1.6;">在 dispatchTouchEvent 返回 super.dispatchTouchEvent(ev) 并且 onInterceptTouchEvent 返回 true 或返回 super.onInterceptTouchEvent(ev) 的情况下 onTouchEvent 会被调用。onTouchEvent 的事件响应逻辑如下：</p>

<pre style="word-break: break-word; font-family: 'Source Code Pro',monospace; white-space: pre-wrap; display: block; background-color: rgba(102,128,153,0.05); color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 2px; border: 0; border-radius: 5px; text-align: start;"><code style="font-family: 'Source Code Pro',monospace; font-size: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; color: #f8f8f2; display: block; background: #23241f; padding: 18px 28px;"><span style="line-height: 1.6; color: #ae81ff;">1.</span>如果事件传递到当前 View 的 onTouchEvent 方法，而该方法返回了 <span style="line-height: 1.6; color: #ae81ff;">false</span>，那么这个事件会从当前 View 向上传递，并且都是由上层 View 的 onTouchEvent 来接收，如果传递到上面的 onTouchEvent 也返回 <span style="line-height: 1.6; color: #ae81ff;">false</span>，这个事件就会“消失”，而且接收不到下一次事件。<br/><span style="line-height: 1.6; color: #ae81ff;">2.</span>如果返回了 <span style="line-height: 1.6; color: #ae81ff;">true</span> 则会接收并消费该事件。<br/><span style="line-height: 1.6; color: #ae81ff;">3.</span>如果返回 <span style="line-height: 1.6; color: #f92672;">super</span>.onTouchEvent(ev) 默认处理事件的逻辑和返回 <span style="line-height: 1.6; color: #ae81ff;">false</span> 时相同。<br/><br/></code></pre></div><div style="line-height: 1.6;"></div></div><center style="display:none">@%28Android%u7B14%u8BB0%29%5B%u81EA%u5DF1%u603B%u7ED3%u7684%5D%0A%0A%23%u4E8B%u4EF6%u5206%u53D1%u673A%u5236%0A%0A**%u4E8B%u4EF6%u5206%u53D1public%20boolean%20dispatchTouchEvent%28MotionEvent%20ev%29**%0A%0ATouch%20%u4E8B%u4EF6%u53D1%u751F%u65F6%20Activity%20%u7684%20dispatchTouchEvent%28MotionEvent%20ev%29%20%u65B9%u6CD5%u4F1A%u4EE5%u96A7%u9053%u65B9%u5F0F%uFF08%u4ECE%u6839%u5143%u7D20%u4F9D%u6B21%u5F80%u4E0B%u4F20%u9012%u76F4%u5230%u6700%u5185%u5C42%u5B50%u5143%u7D20%u6216%u5728%u4E2D%u95F4%u67D0%u4E00%u5143%u7D20%u4E2D%u7531%u4E8E%u67D0%u4E00%u6761%u4EF6%u505C%u6B62%u4F20%u9012%uFF09%u5C06%u4E8B%u4EF6%u4F20%u9012%u7ED9%u6700%u5916%u5C42%20View%20%u7684%20dispatchTouchEvent%28MotionEvent%20ev%29%20%u65B9%u6CD5%uFF0C%u5E76%u7531%u8BE5%20View%20%u7684%20dispatchTouchEvent%28MotionEvent%20ev%29%20%u65B9%u6CD5%u5BF9%u4E8B%u4EF6%u8FDB%u884C%u5206%u53D1%u3002dispatchTouchEvent%20%u7684%u4E8B%u4EF6%u5206%u53D1%u903B%u8F91%u5982%u4E0B%uFF1A%0A%0A%20%20%20%201.%20%u5982%u679C%20return%20true%uFF0C%u4E8B%u4EF6%u4F1A%u5206%u53D1%u7ED9%u5F53%u524D%20View%20%u5E76%u7531%20dispatchTouchEvent%20%u65B9%u6CD5%u8FDB%u884C%u6D88%u8D39%uFF0C%u540C%u65F6%u4E8B%u4EF6%u4F1A%u505C%u6B62%u5411%u4E0B%u4F20%u9012%uFF1B%0A%20%20%20%20%u5982%u679C%20return%20false%uFF0C%u4E8B%u4EF6%u5206%u53D1%u5206%u4E3A%u4E24%u79CD%u60C5%u51B5%uFF1A%0A%0A%20%20%20%202.%20%u5982%u679C%u5F53%u524D%20View%20%u83B7%u53D6%u7684%u4E8B%u4EF6%u76F4%u63A5%u6765%u81EA%20Activity%uFF0C%u5219%u4F1A%u5C06%u4E8B%u4EF6%u8FD4%u56DE%u7ED9%20Activity%20%u7684%20onTouchEvent%20%u8FDB%u884C%u6D88%u8D39%uFF1B%0A%20%20%20%20%u5982%u679C%u5F53%u524D%20View%20%u83B7%u53D6%u7684%u4E8B%u4EF6%u6765%u81EA%u5916%u5C42%u7236%u63A7%u4EF6%uFF0C%u5219%u4F1A%u5C06%u4E8B%u4EF6%u8FD4%u56DE%u7ED9%u7236%20View%20%u7684%20%20onTouchEvent%20%u8FDB%u884C%u6D88%u8D39%u3002%0A%0A%20%20%20%203.%20%u5982%u679C%u8FD4%u56DE%u7CFB%u7EDF%u9ED8%u8BA4%u7684%20super.dispatchTouchEvent%28ev%29%uFF0C%u4E8B%u4EF6%u4F1A%u81EA%u52A8%u7684%u5206%u53D1%u7ED9%u5F53%u524D%20View%20%u7684%20onInterceptTouchEvent%20%u65B9%u6CD5%u3002%0A%0A**%u4E8B%u4EF6%u62E6%u622A%uFF1Apublic%20boolean%20onInterceptTouchEvent%28MotionEvent%20ev%29**%0A%0A%u5728%u5916%u5C42%20View%20%u7684%20dispatchTouchEvent%28MotionEvent%20ev%29%20%u65B9%u6CD5%u8FD4%u56DE%u7CFB%u7EDF%u9ED8%u8BA4%u7684%20super.dispatchTouchEvent%28ev%29%20%u60C5%u51B5%u4E0B%uFF0C%u4E8B%u4EF6%u4F1A%u81EA%u52A8%u7684%u5206%u53D1%u7ED9%u5F53%u524D%20View%20%u7684%20onInterceptTouchEvent%20%u65B9%u6CD5%u3002onInterceptTouchEvent%20%u7684%u4E8B%u4EF6%u62E6%u622A%u903B%u8F91%u5982%u4E0B%uFF1A%0A%0A%20%20%20%201.%20%u5982%u679C%20onInterceptTouchEvent%20%u8FD4%u56DE%20true%uFF0C%u5219%u8868%u793A%u5C06%u4E8B%u4EF6%u8FDB%u884C%u62E6%u622A%uFF0C%u5E76%u5C06%u62E6%u622A%u5230%u7684%u4E8B%u4EF6%u4EA4%u7531%u5F53%u524D%20View%20%u7684%20onTouchEvent%20%u8FDB%u884C%u5904%u7406%uFF1B%0A%20%20%20%202.%20%20%u5982%u679C%20onInterceptTouchEvent%20%u8FD4%u56DE%20false%uFF0C%u5219%u8868%u793A%u5C06%u4E8B%u4EF6%u653E%u884C%uFF0C%u5F53%u524D%20View%20%u4E0A%u7684%u4E8B%u4EF6%u4F1A%u88AB%u4F20%u9012%u5230%u5B50%20View%20%u4E0A%uFF0C%u518D%u7531%u5B50%20View%20%u7684%20dispatchTouchEvent%20%u6765%u5F00%u59CB%u8FD9%u4E2A%u4E8B%u4EF6%u7684%u5206%u53D1%uFF1B%0A%20%20%20%203.%20%u5982%u679C%20onInterceptTouchEvent%20%u8FD4%u56DE%20super.onInterceptTouchEvent%28ev%29%uFF0C%u4E8B%u4EF6%u9ED8%u8BA4%u4F1A%u88AB%u62E6%u622A%uFF0C%u5E76%u5C06%u62E6%u622A%u5230%u7684%u4E8B%u4EF6%u4EA4%u7531%u5F53%u524D%20View%20%u7684%20onTouchEvent%20%u8FDB%u884C%u5904%u7406%u3002%0A%0A**%u4E8B%u4EF6%u54CD%u5E94%uFF1Apublic%20boolean%20onTouchEvent%28MotionEvent%20ev%29**%0A%0A%u5728%20dispatchTouchEvent%20%u8FD4%u56DE%20super.dispatchTouchEvent%28ev%29%20%u5E76%u4E14%20onInterceptTouchEvent%20%u8FD4%u56DE%20true%20%u6216%u8FD4%u56DE%20super.onInterceptTouchEvent%28ev%29%20%u7684%u60C5%u51B5%u4E0B%20onTouchEvent%20%u4F1A%u88AB%u8C03%u7528%u3002onTouchEvent%20%u7684%u4E8B%u4EF6%u54CD%u5E94%u903B%u8F91%u5982%u4E0B%uFF1A%0A%0A%20%20%20%201.%u5982%u679C%u4E8B%u4EF6%u4F20%u9012%u5230%u5F53%u524D%20View%20%u7684%20onTouchEvent%20%u65B9%u6CD5%uFF0C%u800C%u8BE5%u65B9%u6CD5%u8FD4%u56DE%u4E86%20false%uFF0C%u90A3%u4E48%u8FD9%u4E2A%u4E8B%u4EF6%u4F1A%u4ECE%u5F53%u524D%20View%20%u5411%u4E0A%u4F20%u9012%uFF0C%u5E76%u4E14%u90FD%u662F%u7531%u4E0A%u5C42%20View%20%u7684%20onTouchEvent%20%u6765%u63A5%u6536%uFF0C%u5982%u679C%u4F20%u9012%u5230%u4E0A%u9762%u7684%20onTouchEvent%20%u4E5F%u8FD4%u56DE%20false%uFF0C%u8FD9%u4E2A%u4E8B%u4EF6%u5C31%u4F1A%u201C%u6D88%u5931%u201D%uFF0C%u800C%u4E14%u63A5%u6536%u4E0D%u5230%u4E0B%u4E00%u6B21%u4E8B%u4EF6%u3002%0A%20%20%20%202.%u5982%u679C%u8FD4%u56DE%u4E86%20true%20%u5219%u4F1A%u63A5%u6536%u5E76%u6D88%u8D39%u8BE5%u4E8B%u4EF6%u3002%0A%20%20%20%203.%u5982%u679C%u8FD4%u56DE%20super.onTouchEvent%28ev%29%20%u9ED8%u8BA4%u5904%u7406%u4E8B%u4EF6%u7684%u903B%u8F91%u548C%u8FD4%u56DE%20false%20%u65F6%u76F8%u540C%u3002%0A</center><br/></span>
</div></body></html> 